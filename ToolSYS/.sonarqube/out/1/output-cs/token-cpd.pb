¦#
NC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\UnitOfWork\UnitOfWork.cs
	namespace 	
ToolSYS
 
. 
Data 
. 

UnitOfWork !
;! "
public 
	interface 
IUnitOfWork 
: 
IDisposable *
{ 
IRentalData 
Rentals 
{ 
get 
; 
}  
IRentalItemData 
RentalItems 
{  !
get" %
;% &
}' (
void		 
BeginTransaction			 
(		 
)		 
;		 
void

 
Commit

	 
(

 
)

 
;

 
void 
Rollback	 
( 
) 
; 
} 
public 
class 

UnitOfWork 
: 
IUnitOfWork %
{ 
private 
readonly 
OracleConnection %
_connection& 1
;1 2
private 
OracleTransaction 
? 
_transaction +
;+ ,
public 

IRentalData 
Rentals 
{  
get! $
;$ %
}& '
public 

IRentalItemData 
RentalItems &
{' (
get) ,
;, -
}. /
public 


UnitOfWork 
( 
string 
connectionString -
)- .
{ 
_connection 
= 
new 
OracleConnection *
(* +
connectionString+ ;
); <
;< =
_connection 
. 
Open 
( 
) 
; 
Rentals 
= 
new 

RentalData  
(  !
_connection! ,
), -
;- .
RentalItems 
= 
new 
RentalItemData (
(( )
_connection) 4
)4 5
;5 6
} 
public   

void   
BeginTransaction    
(    !
)  ! "
{!! 
_transaction"" 
="" 
_connection"" "
.""" #
BeginTransaction""# 3
(""3 4
)""4 5
;""5 6
(%% 	
(%%	 


RentalData%%
 
)%% 
Rentals%% 
)%% 
.%% 
SetTransaction%% ,
(%%, -
_transaction%%- 9
)%%9 :
;%%: ;
(&& 	
(&&	 

RentalItemData&&
 
)&& 
RentalItems&& $
)&&$ %
.&&% &
SetTransaction&&& 4
(&&4 5
_transaction&&5 A
)&&A B
;&&B C
}'' 
public)) 

void)) 
Commit)) 
()) 
))) 
{** 
try++ 
{,, 	
_transaction-- 
?-- 
.-- 
Commit--  
(--  !
)--! "
;--" #
}.. 	
catch// 
{00 	
_transaction11 
?11 
.11 
Rollback11 "
(11" #
)11# $
;11$ %
throw22 
;22 
}33 	
finally44 
{55 	
_transaction66 
?66 
.66 
Dispose66 !
(66! "
)66" #
;66# $
_transaction77 
=77 
null77 
;77  
}88 	
}99 
public;; 

void;; 
Rollback;; 
(;; 
);; 
{<< 
_transaction== 
?== 
.== 
Rollback== 
(== 
)==  
;==  !
_transaction>> 
?>> 
.>> 
Dispose>> 
(>> 
)>> 
;>>  
_transaction?? 
=?? 
null?? 
;?? 
}@@ 
publicBB 

voidBB 
DisposeBB 
(BB 
)BB 
{CC 
_transactionDD 
?DD 
.DD 
DisposeDD 
(DD 
)DD 
;DD  
_connectionEE 
.EE 
CloseEE 
(EE 
)EE 
;EE 
_connectionFF 
.FF 
DisposeFF 
(FF 
)FF 
;FF 
}GG 
}HH ô©
AC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\ToolData.cs
	namespace 	
ToolSYS
 
. 
Data 
{ 
public 

	interface 
	IToolData 
{ 
void		 
AddTool		 
(		 
Tool		 
tool		 
)		 
;		  
void

 

UpdateTool

 
(

 
Tool

 
tool

 !
)

! "
;

" #
void 

RemoveTool 
( 
int 
toolId "
)" #
;# $
int 
GetNextToolId 
( 
) 
; 
DataSet 
GetFilteredTools  
(  !
string! '
toolIdAsString( 6
,6 7
string8 >
categoryCode? K
,K L
stringM S
descriptionT _
,_ `
stringa g
manufacturerh t
,t u
stringv |
status	} ƒ
,
ƒ „
string
… ‹
phrase
Œ ’
)
’ “
;
“ ”
DataSet 
GetAvailableTools !
(! "
)" #
;# $
DataSet 
GetRentableTools  
(  !
string! '
categoryCode( 4
,4 5
DateTime6 >
from? C
,C D
DateTimeE M
toN P
)P Q
;Q R
bool 

ToolExists 
( 
int 
toolId #
)# $
;$ %
} 
public 

class 
ToolData 
: 
	IToolData %
{ 
private 
readonly 
string 
_connectionString  1
=2 3
	DbConnect4 =
.= >
Oradb> C
;C D
public 
void 
AddTool 
( 
Tool  
tool! %
)% &
{ 	
using 
( 
OracleConnection #
conn$ (
=) *
new+ .
OracleConnection/ ?
(? @
_connectionString@ Q
)Q R
)R S
{ 
string 
sqlQuery 
=  !
$str" |
+} ~
$str$ w
;w x
OracleCommand 
cmd !
=" #
new$ '
OracleCommand( 5
(5 6
sqlQuery6 >
,> ?
conn@ D
)D E
;E F
cmd 
. 

Parameters 
. 
Add "
(" #
$str# ,
,, -
tool. 2
.2 3
toolId3 9
)9 :
;: ;
cmd   
.   

Parameters   
.   
Add   "
(  " #
$str  # 2
,  2 3
tool  4 8
.  8 9
categoryCode  9 E
.  E F
	Substring  F O
(  O P
$num  P Q
,  Q R
$num  S T
)  T U
)  U V
;  V W
cmd!! 
.!! 

Parameters!! 
.!! 
Add!! "
(!!" #
$str!!# 5
,!!5 6
tool!!7 ;
.!!; <
toolDescription!!< K
)!!K L
;!!L M
cmd"" 
."" 

Parameters"" 
."" 
Add"" "
(""" #
$str""# 6
,""6 7
tool""8 <
.""< =
toolManufacturer""= M
)""M N
;""N O
cmd## 
.## 

Parameters## 
.## 
Add## "
(##" #
$str### 0
,##0 1
tool##2 6
.##6 7

toolStatus##7 A
)##A B
;##B C
conn%% 
.%% 
Open%% 
(%% 
)%% 
;%% 
cmd&& 
.&& 
ExecuteNonQuery&& #
(&&# $
)&&$ %
;&&% &
}'' 
}(( 	
public** 
void** 

UpdateTool** 
(** 
Tool** #
tool**$ (
)**( )
{++ 	
using,, 
(,, 
OracleConnection,, #
conn,,$ (
=,,) *
new,,+ .
OracleConnection,,/ ?
(,,? @
_connectionString,,@ Q
),,Q R
),,R S
{-- 
string.. 
sqlQuery.. 
=..  !
$str.." 5
+..6 7
$str//$ D
+//E F
$str00$ J
+00K L
$str11$ L
+11M N
$str22$ ?
+22@ A
$str33$ <
;33< =
OracleCommand55 
cmd55 !
=55" #
new55$ '
OracleCommand55( 5
(555 6
sqlQuery556 >
,55> ?
conn55@ D
)55D E
;55E F
cmd66 
.66 

Parameters66 
.66 
Add66 "
(66" #
$str66# 2
,662 3
tool664 8
.668 9
categoryCode669 E
)66E F
;66F G
cmd77 
.77 

Parameters77 
.77 
Add77 "
(77" #
$str77# 5
,775 6
tool777 ;
.77; <
toolDescription77< K
)77K L
;77L M
cmd88 
.88 

Parameters88 
.88 
Add88 "
(88" #
$str88# 6
,886 7
tool888 <
.88< =
toolManufacturer88= M
)88M N
;88N O
cmd99 
.99 

Parameters99 
.99 
Add99 "
(99" #
$str99# 0
,990 1
tool992 6
.996 7

toolStatus997 A
)99A B
;99B C
cmd:: 
.:: 

Parameters:: 
.:: 
Add:: "
(::" #
$str::# ,
,::, -
tool::. 2
.::2 3
toolId::3 9
)::9 :
;::: ;
conn<< 
.<< 
Open<< 
(<< 
)<< 
;<< 
cmd== 
.== 
ExecuteNonQuery== #
(==# $
)==$ %
;==% &
}>> 
}?? 	
publicAA 
voidAA 

RemoveToolAA 
(AA 
intAA "
toolIdAA# )
)AA) *
{BB 	
usingCC 
(CC 
OracleConnectionCC #
connCC$ (
=CC) *
newCC+ .
OracleConnectionCC/ ?
(CC? @
_connectionStringCC@ Q
)CCQ R
)CCR S
{DD 
stringEE 
sqlQueryEE 
=EE  !
$strEE" \
;EE\ ]
OracleCommandFF 
cmdFF !
=FF" #
newFF$ '
OracleCommandFF( 5
(FF5 6
sqlQueryFF6 >
,FF> ?
connFF@ D
)FFD E
;FFE F
cmdGG 
.GG 

ParametersGG 
.GG 
AddGG "
(GG" #
$strGG# ,
,GG, -
toolIdGG. 4
)GG4 5
;GG5 6
connII 
.II 
OpenII 
(II 
)II 
;II 
cmdJJ 
.JJ 
ExecuteNonQueryJJ #
(JJ# $
)JJ$ %
;JJ% &
}KK 
}LL 	
publicNN 
intNN 
GetNextToolIdNN  
(NN  !
)NN! "
{OO 	
usingPP 
(PP 
OracleConnectionPP #
connPP$ (
=PP) *
newPP+ .
OracleConnectionPP/ ?
(PP? @
_connectionStringPP@ Q
)PPQ R
)PPR S
{QQ 
stringRR 
sqlQueryRR 
=RR  !
$strRR" A
;RRA B
OracleCommandSS 
cmdSS !
=SS" #
newSS$ '
OracleCommandSS( 5
(SS5 6
sqlQuerySS6 >
,SS> ?
connSS@ D
)SSD E
;SSE F
connTT 
.TT 
OpenTT 
(TT 
)TT 
;TT 
objectVV 
resultVV 
=VV 
cmdVV  #
.VV# $
ExecuteScalarVV$ 1
(VV1 2
)VV2 3
;VV3 4
returnWW 
(WW 
resultWW 
==WW !
DBNullWW" (
.WW( )
ValueWW) .
)WW. /
?WW0 1
$numWW2 3
:WW4 5
ConvertWW6 =
.WW= >
ToInt32WW> E
(WWE F
resultWWF L
)WWL M
+WWN O
$numWWP Q
;WWQ R
}XX 
}YY 	
public[[ 
DataSet[[ 
GetFilteredTools[[ '
([[' (
string[[( .
toolIdAsString[[/ =
,[[= >
string[[? E
categoryCode[[F R
,[[R S
string[[T Z
description[[[ f
,[[f g
string[[h n
manufacturer[[o {
,[[{ |
string	[[} ƒ
status
[[„ Š
,
[[Š ‹
string
[[Œ ’
phrase
[[“ ™
)
[[™ š
{\\ 	
using]] 
(]] 
OracleConnection]] #
conn]]$ (
=]]) *
new]]+ .
OracleConnection]]/ ?
(]]? @
_connectionString]]@ Q
)]]Q R
)]]R S
{^^ 
string__ 
sqlQuery__ 
=__  !
DetermineSqlQuery__" 3
(__3 4
toolIdAsString__4 B
,__B C
categoryCode__D P
,__P Q
description__R ]
,__] ^
manufacturer___ k
,__k l
status__m s
,__s t
phrase__u {
)__{ |
;__| }
OracleCommandaa 
cmdaa !
=aa" #
newaa$ '
OracleCommandaa( 5
(aa5 6
sqlQueryaa6 >
,aa> ?
connaa@ D
)aaD E
;aaE F
OracleDataAdapterbb !
dabb" $
=bb% &
newbb' *
OracleDataAdapterbb+ <
(bb< =
cmdbb= @
)bb@ A
;bbA B
DataSetdd 
dsdd 
=dd 
newdd  
DataSetdd! (
(dd( )
)dd) *
;dd* +
daee 
.ee 
Fillee 
(ee 
dsee 
,ee 
$stree "
)ee" #
;ee# $
returngg 
dsgg 
;gg 
}hh 
}ii 	
privatekk 
statickk 
Stringkk 
DetermineSqlQuerykk /
(kk/ 0
Stringkk0 6
toolIdAsStringkk7 E
,kkE F
StringkkG M
categoryCodekkN Z
,kkZ [
Stringkk\ b
descriptionkkc n
,kkn o
Stringkkp v
manufacturer	kkw ƒ
,
kkƒ „
String
kk… ‹
status
kkŒ ’
,
kk’ “
String
kk” š
phrase
kk› ¡
)
kk¡ ¢
{ll 	
Stringmm 
sqlQuerymm 
=mm 
$strmm  
;mm  !
ifoo 
(oo 
stringoo 
.oo 
IsNullOrEmptyoo $
(oo$ %
toolIdAsStringoo% 3
)oo3 4
&&oo5 7
Stringoo8 >
.oo> ?
IsNullOrEmptyoo? L
(ooL M
categoryCodeooM Y
)ooY Z
&&oo[ ]
stringoo^ d
.ood e
IsNullOrEmptyooe r
(oor s
descriptionoos ~
)oo~ 
&&
oo€ ‚
string
ooƒ ‰
.
oo‰ Š
IsNullOrEmpty
ooŠ —
(
oo— ˜
manufacturer
oo˜ ¤
)
oo¤ ¥
&&
oo¦ ¨
string
oo© ¯
.
oo¯ °
IsNullOrEmpty
oo° ½
(
oo½ ¾
status
oo¾ Ä
)
ooÄ Å
&&
ooÆ È
string
ooÉ Ï
.
ooÏ Ð
IsNullOrEmpty
ooÐ Ý
(
ooÝ Þ
phrase
ooÞ ä
)
ooä å
)
ooå æ
{pp 
sqlQueryqq 
=qq 
$strqq r
;qqr s
}rr 
elsess 
ifss 
(ss 
!ss 
stringss 
.ss 
IsNullOrEmptyss *
(ss* +
toolIdAsStringss+ 9
)ss9 :
||ss; =
!ss> ?
stringss? E
.ssE F
IsNullOrEmptyssF S
(ssS T
categoryCodessT `
)ss` a
||ssb d
!sse f
stringssf l
.ssl m
IsNullOrEmptyssm z
(ssz {
description	ss{ †
)
ss† ‡
||
ssˆ Š
!
ss‹ Œ
string
ssŒ ’
.
ss’ “
IsNullOrEmpty
ss“  
(
ss  ¡
manufacturer
ss¡ ­
)
ss­ ®
||
ss¯ ±
!
ss² ³
string
ss³ ¹
.
ss¹ º
IsNullOrEmpty
ssº Ç
(
ssÇ È
status
ssÈ Î
)
ssÎ Ï
||
ssÐ Ò
!
ssÓ Ô
string
ssÔ Ú
.
ssÚ Û
IsNullOrEmpty
ssÛ è
(
ssè é
phrase
ssé ï
)
ssï ð
)
ssð ñ
{tt 
sqlQueryuu 
=uu 
$struu ~
;uu~ 
ifww 
(ww 
!ww 
stringww 
.ww 
IsNullOrEmptyww )
(ww) *
toolIdAsStringww* 8
)ww8 9
)ww9 :
{xx 
intyy 
toolIdyy 
=yy  
Convertyy! (
.yy( )
ToInt32yy) 0
(yy0 1
toolIdAsStringyy1 ?
)yy? @
;yy@ A
sqlQueryzz 
+=zz 
$strzz  0
+zz1 2
toolIdzz3 9
;zz9 :
}{{ 
if|| 
(|| 
!|| 
string|| 
.|| 
IsNullOrEmpty|| )
(||) *
categoryCode||* 6
)||6 7
)||7 8
{}} 
categoryCode~~  
=~~! "
categoryCode~~# /
.~~/ 0
	Substring~~0 9
(~~9 :
$num~~: ;
,~~; <
$num~~= >
)~~> ?
;~~? @
sqlQuery 
+= 
$str  G
+H I
categoryCodeJ V
+W X
$strY ]
;] ^
}
€€ 
if
 
(
 
!
 
string
 
.
 
IsNullOrEmpty
 )
(
) *
description
* 5
)
5 6
)
6 7
{
‚‚ 
sqlQuery
ƒƒ 
+=
ƒƒ 
$str
ƒƒ  K
+
ƒƒL M
description
ƒƒN Y
+
ƒƒZ [
$str
ƒƒ\ a
;
ƒƒa b
}
„„ 
if
…… 
(
…… 
!
…… 
string
…… 
.
…… 
IsNullOrEmpty
…… )
(
……) *
manufacturer
……* 6
)
……6 7
)
……7 8
{
†† 
sqlQuery
‡‡ 
+=
‡‡ 
$str
‡‡  L
+
‡‡M N
manufacturer
‡‡O [
+
‡‡\ ]
$str
‡‡^ c
;
‡‡c d
}
ˆˆ 
if
‰‰ 
(
‰‰ 
!
‰‰ 
string
‰‰ 
.
‰‰ 
IsNullOrEmpty
‰‰ )
(
‰‰) *
status
‰‰* 0
)
‰‰0 1
)
‰‰1 2
{
ŠŠ 
status
‹‹ 
=
‹‹ 
status
‹‹ #
.
‹‹# $
	Substring
‹‹$ -
(
‹‹- .
$num
‹‹. /
,
‹‹/ 0
$num
‹‹1 2
)
‹‹2 3
;
‹‹3 4
sqlQuery
ŒŒ 
+=
ŒŒ 
$str
ŒŒ  5
+
ŒŒ6 7
status
ŒŒ8 >
+
ŒŒ? @
$str
ŒŒA D
;
ŒŒD E
}
 
if
ŽŽ 
(
ŽŽ 
!
ŽŽ 
string
ŽŽ 
.
ŽŽ 
IsNullOrEmpty
ŽŽ )
(
ŽŽ) *
phrase
ŽŽ* 0
)
ŽŽ0 1
)
ŽŽ1 2
{
 
sqlQuery
 
+=
 
$str
  I
+
J K
phrase
L R
+
S T
$str
U [
+
\ ]
$str
‘‘ A
+
‘‘B C
phrase
‘‘D J
+
‘‘K L
$str
‘‘M S
+
‘‘T U
$str
’’ B
+
’’C D
phrase
’’E K
+
’’L M
$str
’’N T
;
’’T U
}
““ 
}
”” 
return
•• 
sqlQuery
•• 
;
•• 
}
–– 	
public
˜˜ 
DataSet
˜˜ 
GetAvailableTools
˜˜ (
(
˜˜( )
)
˜˜) *
{
™™ 	
using
šš 
(
šš 
OracleConnection
šš #
conn
šš$ (
=
šš) *
new
šš+ .
OracleConnection
šš/ ?
(
šš? @
_connectionString
šš@ Q
)
ššQ R
)
ššR S
{
›› 
string
œœ 
sqlQuery
œœ 
=
œœ  !
$str
œœ" n
+
œœo p
$str
 (
;
( )
OracleCommand
ŸŸ 
cmd
ŸŸ !
=
ŸŸ" #
new
ŸŸ$ '
OracleCommand
ŸŸ( 5
(
ŸŸ5 6
sqlQuery
ŸŸ6 >
,
ŸŸ> ?
conn
ŸŸ@ D
)
ŸŸD E
;
ŸŸE F
OracleDataAdapter
   !
da
  " $
=
  % &
new
  ' *
OracleDataAdapter
  + <
(
  < =
cmd
  = @
)
  @ A
;
  A B
DataSet
¢¢ 
ds
¢¢ 
=
¢¢ 
new
¢¢  
DataSet
¢¢! (
(
¢¢( )
)
¢¢) *
;
¢¢* +
da
££ 
.
££ 
Fill
££ 
(
££ 
ds
££ 
,
££ 
$str
££ "
)
££" #
;
££# $
return
¥¥ 
ds
¥¥ 
;
¥¥ 
}
¦¦ 
}
§§ 	
public
©© 
DataSet
©© 
GetRentableTools
©© '
(
©©' (
string
©©( .
categoryCode
©©/ ;
,
©©; <
DateTime
©©= E
from
©©F J
,
©©J K
DateTime
©©L T
to
©©U W
)
©©W X
{
ªª 	
using
«« 
(
«« 
OracleConnection
«« #
conn
««$ (
=
««) *
new
««+ .
OracleConnection
««/ ?
(
««? @
_connectionString
««@ Q
)
««Q R
)
««R S
{
¬¬ 
string
­­ 
sqlQuery
­­ 
=
­­  !
$str
­·" 
;
·· 
using
¹¹ 
(
¹¹ 
OracleCommand
¹¹ $
cmd
¹¹% (
=
¹¹) *
new
¹¹+ .
OracleCommand
¹¹/ <
(
¹¹< =
sqlQuery
¹¹= E
,
¹¹E F
conn
¹¹G K
)
¹¹K L
)
¹¹L M
{
ºº 
cmd
»» 
.
»» 

Parameters
»» "
.
»»" #
Add
»»# &
(
»»& '
new
»»' *
OracleParameter
»»+ :
(
»»: ;
$str
»»; J
,
»»J K
categoryCode
»»L X
)
»»X Y
)
»»Y Z
;
»»Z [
cmd
¼¼ 
.
¼¼ 

Parameters
¼¼ "
.
¼¼" #
Add
¼¼# &
(
¼¼& '
new
¼¼' *
OracleParameter
¼¼+ :
(
¼¼: ;
$str
¼¼; F
,
¼¼F G
from
¼¼H L
.
¼¼L M
ToString
¼¼M U
(
¼¼U V
$str
¼¼V a
)
¼¼a b
)
¼¼b c
)
¼¼c d
;
¼¼d e
cmd
½½ 
.
½½ 

Parameters
½½ "
.
½½" #
Add
½½# &
(
½½& '
new
½½' *
OracleParameter
½½+ :
(
½½: ;
$str
½½; D
,
½½D E
to
½½F H
.
½½H I
ToString
½½I Q
(
½½Q R
$str
½½R ]
)
½½] ^
)
½½^ _
)
½½_ `
;
½½` a
OracleDataAdapter
¿¿ %
da
¿¿& (
=
¿¿) *
new
¿¿+ .
OracleDataAdapter
¿¿/ @
(
¿¿@ A
cmd
¿¿A D
)
¿¿D E
;
¿¿E F
DataSet
ÀÀ 
ds
ÀÀ 
=
ÀÀ  
new
ÀÀ! $
DataSet
ÀÀ% ,
(
ÀÀ, -
)
ÀÀ- .
;
ÀÀ. /
da
ÁÁ 
.
ÁÁ 
Fill
ÁÁ 
(
ÁÁ 
ds
ÁÁ 
,
ÁÁ 
$str
ÁÁ  &
)
ÁÁ& '
;
ÁÁ' (
return
ÃÃ 
ds
ÃÃ 
;
ÃÃ 
}
ÄÄ 
}
ÅÅ 
}
ÆÆ 	
public
ÇÇ 
bool
ÇÇ 

ToolExists
ÇÇ 
(
ÇÇ 
int
ÇÇ "
toolId
ÇÇ# )
)
ÇÇ) *
{
ÈÈ 	
using
ÉÉ 
(
ÉÉ 
OracleConnection
ÉÉ #
conn
ÉÉ$ (
=
ÉÉ) *
new
ÉÉ+ .
OracleConnection
ÉÉ/ ?
(
ÉÉ? @
_connectionString
ÉÉ@ Q
)
ÉÉQ R
)
ÉÉR S
{
ÊÊ 
string
ËË 
sqlQuery
ËË 
=
ËË  !
$str
ËË" j
;
ËËj k
OracleCommand
ÌÌ 
cmd
ÌÌ !
=
ÌÌ" #
new
ÌÌ$ '
OracleCommand
ÌÌ( 5
(
ÌÌ5 6
sqlQuery
ÌÌ6 >
,
ÌÌ> ?
conn
ÌÌ@ D
)
ÌÌD E
;
ÌÌE F
cmd
ÍÍ 
.
ÍÍ 

Parameters
ÍÍ 
.
ÍÍ 
Add
ÍÍ "
(
ÍÍ" #
$str
ÍÍ# ,
,
ÍÍ, -
toolId
ÍÍ. 4
)
ÍÍ4 5
;
ÍÍ5 6
conn
ÏÏ 
.
ÏÏ 
Open
ÏÏ 
(
ÏÏ 
)
ÏÏ 
;
ÏÏ 
int
ÐÐ 
count
ÐÐ 
=
ÐÐ 
Convert
ÐÐ #
.
ÐÐ# $
ToInt32
ÐÐ$ +
(
ÐÐ+ ,
cmd
ÐÐ, /
.
ÐÐ/ 0
ExecuteScalar
ÐÐ0 =
(
ÐÐ= >
)
ÐÐ> ?
)
ÐÐ? @
;
ÐÐ@ A
conn
ÑÑ 
.
ÑÑ 
Close
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
return
ÓÓ 
count
ÓÓ 
>
ÓÓ 
$num
ÓÓ  
;
ÓÓ  !
}
ÔÔ 
}
ÕÕ 	
}
×× 
}ØØ ‡$
GC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\RentalItemData.cs
	namespace 	
ToolSYS
 
. 
Data 
{ 
public 

	interface 
IRentalItemData $
{ 
void		 
AddRentalItem		 
(		 

RentalItem		 %

rentalItem		& 0
)		0 1
;		1 2
}

 
public 

class 
RentalItemData 
:  !
IRentalItemData" 1
{ 
private 
readonly 
OracleConnection )
_connection* 5
;5 6
private 
OracleTransaction !
_transaction" .
;. /
public 
RentalItemData 
( 
OracleConnection .

connection/ 9
)9 :
{ 	
_connection 
= 

connection $
;$ %
} 	
public 
void 
SetTransaction "
(" #
OracleTransaction# 4
transaction5 @
)@ A
{ 	
_transaction 
= 
transaction &
;& '
} 	
public 
void 
AddRentalItem !
(! "

RentalItem" ,

rentalItem- 7
)7 8
{ 	
string 
	sqlInsert 
= 
$str T
;T U
using 
( 
var 
cmd 
= 
new  
OracleCommand! .
(. /
	sqlInsert/ 8
,8 9
_connection: E
)E F
)F G
{   
cmd!! 
.!! 
Transaction!! 
=!!  !
_transaction!!" .
;!!. /
cmd"" 
."" 

Parameters"" 
."" 
Add"" "
(""" #
$str""# .
,"". /
OracleDbType""0 <
.""< =
Int32""= B
)""B C
.""C D
Value""D I
=""J K

rentalItem""L V
.""V W
rentalId""W _
;""_ `
cmd## 
.## 

Parameters## 
.## 
Add## "
(##" #
$str### ,
,##, -
OracleDbType##. :
.##: ;
Int32##; @
)##@ A
.##A B
Value##B G
=##H I

rentalItem##J T
.##T U
toolId##U [
;##[ \
cmd$$ 
.$$ 

Parameters$$ 
.$$ 
Add$$ "
($$" #
$str$$# .
,$$. /
OracleDbType$$0 <
.$$< =
Date$$= A
)$$A B
.$$B C
Value$$C H
=$$I J

rentalItem$$K U
.$$U V
rentDate$$V ^
;$$^ _
cmd%% 
.%% 

Parameters%% 
.%% 
Add%% "
(%%" #
$str%%# 0
,%%0 1
OracleDbType%%2 >
.%%> ?
Date%%? C
)%%C D
.%%D E
Value%%E J
=%%K L

rentalItem%%M W
.%%W X

returnDate%%X b
;%%b c
cmd&& 
.&& 

Parameters&& 
.&& 
Add&& "
(&&" #
$str&&# /
,&&/ 0
OracleDbType&&1 =
.&&= >
Decimal&&> E
)&&E F
.&&F G
Value&&G L
=&&M N

rentalItem&&O Y
.&&Y Z
	rentalFee&&Z c
;&&c d
cmd(( 
.(( 
ExecuteNonQuery(( #
(((# $
)(($ %
;((% &
})) 
string++ 
sqlUpdateStatus++ "
=++# $
$str++% _
;++_ `
using-- 
(-- 
var-- 
cmd-- 
=-- 
new--  
OracleCommand--! .
(--. /
sqlUpdateStatus--/ >
,--> ?
_connection--@ K
)--K L
)--L M
{.. 
cmd// 
.// 
Transaction// 
=//  !
_transaction//" .
;//. /
cmd00 
.00 

Parameters00 
.00 
Add00 "
(00" #
$str00# ,
,00, -
OracleDbType00. :
.00: ;
Int3200; @
)00@ A
.00A B
Value00B G
=00H I

rentalItem00J T
.00T U
toolId00U [
;00[ \
cmd22 
.22 
ExecuteNonQuery22 #
(22# $
)22$ %
;22% &
}33 
}44 	
}55 
}66 ¿9
CC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\RentalData.cs
	namespace 	
ToolSYS
 
. 
Data 
{ 
public 

	interface 
IRentalData  
{ 
int		 
GetNextRentalId		 
(		 
)		 
;		 
void

 
	AddRental

 
(

 
Rental

 
rental

 $
)

$ %
;

% &
	DataTable $
GetRentalItemsByRentalId *
(* +
int+ .
rentalId/ 7
)7 8
;8 9
void 

ReturnTool 
( 
int 
rentalId $
,$ %
int& )
toolId* 0
)0 1
;1 2
} 
public 

class 

RentalData 
: 
IRentalData )
{ 
private 
readonly 
OracleConnection )
_connection* 5
;5 6
private 
OracleTransaction !
_transaction" .
;. /
public 

RentalData 
( 
OracleConnection *

connection+ 5
)5 6
{ 	
_connection 
= 

connection $
;$ %
} 	
public 
void 
SetTransaction "
(" #
OracleTransaction# 4
transaction5 @
)@ A
{ 	
_transaction 
= 
transaction &
;& '
} 	
public 
int 
GetNextRentalId "
(" #
)# $
{ 	
string   
sqlQuery   
=   
$str   M
;  M N
using!! 
(!! 
var!! 
cmd!! 
=!! 
new!!  
OracleCommand!!! .
(!!. /
sqlQuery!!/ 7
,!!7 8
_connection!!9 D
)!!D E
)!!E F
{"" 
cmd## 
.## 
Transaction## 
=##  !
_transaction##" .
;##. /
return$$ 
Convert$$ 
.$$ 
ToInt32$$ &
($$& '
cmd$$' *
.$$* +
ExecuteScalar$$+ 8
($$8 9
)$$9 :
)$$: ;
;$$; <
}%% 
}&& 	
public(( 
void(( 
	AddRental(( 
((( 
Rental(( $
rental((% +
)((+ ,
{)) 	
string** 
sqlQuery** 
=** 
$str*, Q
;,,Q R
using.. 
(.. 
var.. 
cmd.. 
=.. 
new..  
OracleCommand..! .
(... /
sqlQuery../ 7
,..7 8
_connection..9 D
)..D E
)..E F
{// 
cmd00 
.00 
Transaction00 
=00  !
_transaction00" .
;00. /
cmd11 
.11 

Parameters11 
.11 
Add11 "
(11" #
$str11# .
,11. /
rental110 6
.116 7
rentalId117 ?
)11? @
;11@ A
cmd22 
.22 

Parameters22 
.22 
Add22 "
(22" #
$str22# 0
,220 1
rental222 8
.228 9

customerId229 C
)22C D
;22D E
cmd33 
.33 

Parameters33 
.33 
Add33 "
(33" #
$str33# 5
,335 6
rental337 =
.33= >
transactionDate33> M
)33M N
;33N O
cmd44 
.44 

Parameters44 
.44 
Add44 "
(44" #
$str44# .
,44. /
rental440 6
.446 7
totalFee447 ?
)44? @
;44@ A
cmd55 
.55 
ExecuteNonQuery55 #
(55# $
)55$ %
;55% &
}66 
}77 	
public99 
	DataTable99 $
GetRentalItemsByRentalId99 1
(991 2
int992 5
rentalId996 >
)99> ?
{:: 	
string;; 
query;; 
=;; 
$str;@ V
;@@V W
usingBB 
(BB 
varBB 
cmdBB 
=BB 
newBB  
OracleCommandBB! .
(BB. /
queryBB/ 4
,BB4 5
_connectionBB6 A
)BBA B
)BBB C
{CC 
cmdDD 
.DD 
TransactionDD 
=DD  !
_transactionDD" .
;DD. /
cmdEE 
.EE 

ParametersEE 
.EE 
AddEE "
(EE" #
$strEE# .
,EE. /
rentalIdEE0 8
)EE8 9
;EE9 :
OracleDataAdapterGG !
adapterGG" )
=GG* +
newGG, /
OracleDataAdapterGG0 A
(GGA B
cmdGGB E
)GGE F
;GGF G
	DataTableHH 
dtHH 
=HH 
newHH "
	DataTableHH# ,
(HH, -
)HH- .
;HH. /
adapterII 
.II 
FillII 
(II 
dtII 
)II  
;II  !
returnKK 
dtKK 
;KK 
}LL 
}MM 	
publicOO 
voidOO 

ReturnToolOO 
(OO 
intOO "
rentalIdOO# +
,OO+ ,
intOO- 0
toolIdOO1 7
)OO7 8
{PP 	
stringQQ 
updateToolQueryQQ "
=QQ# $
$strQQ% _
;QQ_ `
usingRR 
(RR 
varRR 
cmdRR 
=RR 
newRR  
OracleCommandRR! .
(RR. /
updateToolQueryRR/ >
,RR> ?
_connectionRR@ K
)RRK L
)RRL M
{SS 
cmdTT 
.TT 
TransactionTT 
=TT  !
_transactionTT" .
;TT. /
cmdUU 
.UU 

ParametersUU 
.UU 
AddUU "
(UU" #
$strUU# ,
,UU, -
toolIdUU. 4
)UU4 5
;UU5 6
cmdVV 
.VV 
ExecuteNonQueryVV #
(VV# $
)VV$ %
;VV% &
}WW 
stringYY !
updateRentalItemQueryYY (
=YY) *
$str	YY+ ‰
;
YY‰ Š
usingZZ 
(ZZ 
varZZ 
cmdZZ 
=ZZ 
newZZ  
OracleCommandZZ! .
(ZZ. /!
updateRentalItemQueryZZ/ D
,ZZD E
_connectionZZF Q
)ZZQ R
)ZZR S
{[[ 
cmd\\ 
.\\ 
Transaction\\ 
=\\  !
_transaction\\" .
;\\. /
cmd]] 
.]] 

Parameters]] 
.]] 
Add]] "
(]]" #
$str]]# .
,]]. /
rentalId]]0 8
)]]8 9
;]]9 :
cmd^^ 
.^^ 

Parameters^^ 
.^^ 
Add^^ "
(^^" #
$str^^# ,
,^^, -
toolId^^. 4
)^^4 5
;^^5 6
cmd__ 
.__ 
ExecuteNonQuery__ #
(__# $
)__$ %
;__% &
}`` 
}aa 	
}bb 
}cc ÈC
AC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\RateData.cs
	namespace 	
ToolSYS
 
. 
Data 
{ 
public 

	interface 
	IRateData 
{ 
void		 
AddRate		 
(		 
Rate		 
rate		 
)		 
;		  
Rate

 !
GetRateByCategoryCode

 "
(

" #
string

# )
categoryCode

* 6
)

6 7
;

7 8
void 

UpdateRate 
( 
Rate 
rate !
)! "
;" #
DataSet 
GetAllCategories  
(  !
)! "
;" #
bool !
DoesCategoryCodeExist "
(" #
string# )
categoryCode* 6
)6 7
;7 8
} 
public 

class 
RateData 
: 
	IRateData %
{ 
private 
readonly 
string 
_connectionString  1
=2 3
	DbConnect4 =
.= >
Oradb> C
;C D
public 
void 
AddRate 
( 
Rate  
rate! %
)% &
{ 	
using 
( 
var 
conn 
= 
new !
OracleConnection" 2
(2 3
_connectionString3 D
)D E
)E F
{ 
string 
sqlQuery 
=  !
$str	" …
;
… †
OracleCommand 
cmd !
=" #
new$ '
OracleCommand( 5
(5 6
sqlQuery6 >
,> ?
conn@ D
)D E
;E F
cmd 
. 

Parameters 
. 
Add "
(" #
$str# 2
,2 3
rate4 8
.8 9
categoryCode9 E
)E F
;F G
cmd 
. 

Parameters 
. 
Add "
(" #
$str# 2
,2 3
rate4 8
.8 9
categoryDesc9 E
)E F
;F G
cmd 
. 

Parameters 
. 
Add "
(" #
$str# *
,* +
rate, 0
.0 1
rate1 5
)5 6
;6 7
conn 
. 
Open 
( 
) 
; 
cmd 
. 
ExecuteNonQuery #
(# $
)$ %
;% &
}   
}!! 	
public## 
Rate## !
GetRateByCategoryCode## )
(##) *
string##* 0
categoryCode##1 =
)##= >
{$$ 	
using%% 
(%% 
var%% 
conn%% 
=%% 
new%% !
OracleConnection%%" 2
(%%2 3
_connectionString%%3 D
)%%D E
)%%E F
{&& 
string'' 
sqlQuery'' 
=''  !
$str(( k
;((k l
OracleCommand)) 
cmd)) !
=))" #
new))$ '
OracleCommand))( 5
())5 6
sqlQuery))6 >
,))> ?
conn))@ D
)))D E
;))E F
cmd** 
.** 

Parameters** 
.** 
Add** "
(**" #
$str**# 2
,**2 3
categoryCode**4 @
)**@ A
;**A B
conn,, 
.,, 
Open,, 
(,, 
),, 
;,, 
OracleDataReader--  
dr--! #
=--$ %
cmd--& )
.--) *
ExecuteReader--* 7
(--7 8
)--8 9
;--9 :
dr// 
.// 
Read// 
(// 
)// 
;// 
return00 
new00 
Rate00 
{11 
categoryCode22  
=22! "
dr22# %
.22% &
	GetString22& /
(22/ 0
$num220 1
)221 2
,222 3
categoryDesc33  
=33! "
dr33# %
.33% &
	GetString33& /
(33/ 0
$num330 1
)331 2
,332 3
rate44 
=44 
dr44 
.44 

GetDecimal44 (
(44( )
$num44) *
)44* +
}55 
;55 
}66 
}77 	
public99 
void99 

UpdateRate99 
(99 
Rate99 #
rate99$ (
)99( )
{:: 	
using;; 
(;; 
var;; 
conn;; 
=;; 
new;; !
OracleConnection;;" 2
(;;2 3
_connectionString;;3 D
);;D E
);;E F
{<< 
string== 
sqlQuery== 
===  !
$str	==" ‚
;
==‚ ƒ
OracleCommand>> 
cmd>> !
=>>" #
new>>$ '
OracleCommand>>( 5
(>>5 6
sqlQuery>>6 >
,>>> ?
conn>>@ D
)>>D E
;>>E F
cmd?? 
.?? 

Parameters?? 
.?? 
Add?? "
(??" #
$str??# 2
,??2 3
rate??4 8
.??8 9
categoryDesc??9 E
)??E F
;??F G
cmd@@ 
.@@ 

Parameters@@ 
.@@ 
Add@@ "
(@@" #
$str@@# *
,@@* +
rate@@, 0
.@@0 1
rate@@1 5
)@@5 6
;@@6 7
cmdAA 
.AA 

ParametersAA 
.AA 
AddAA "
(AA" #
$strAA# 2
,AA2 3
rateAA4 8
.AA8 9
categoryCodeAA9 E
)AAE F
;AAF G
connCC 
.CC 
OpenCC 
(CC 
)CC 
;CC 
cmdDD 
.DD 
ExecuteNonQueryDD #
(DD# $
)DD$ %
;DD% &
}EE 
}FF 	
publicHH 
DataSetHH 
GetAllCategoriesHH '
(HH' (
)HH( )
{II 	
usingJJ 
(JJ 
varJJ 
connJJ 
=JJ 
newJJ !
OracleConnectionJJ" 2
(JJ2 3
_connectionStringJJ3 D
)JJD E
)JJE F
{KK 
stringLL 
sqlQueryLL 
=LL  !
$strLL" M
;LLM N
OracleDataAdapterMM !
daMM" $
=MM% &
newMM' *
OracleDataAdapterMM+ <
(MM< =
sqlQueryMM= E
,MME F
connMMG K
)MMK L
;MML M
DataSetOO 
dsOO 
=OO 
newOO  
DataSetOO! (
(OO( )
)OO) *
;OO* +
daPP 
.PP 
FillPP 
(PP 
dsPP 
,PP 
$strPP #
)PP# $
;PP$ %
returnRR 
dsRR 
;RR 
}SS 
}TT 	
publicVV 
boolVV !
DoesCategoryCodeExistVV )
(VV) *
stringVV* 0
categoryCodeVV1 =
)VV= >
{WW 	
usingXX 
(XX 
varXX 
connXX 
=XX 
newXX !
OracleConnectionXX" 2
(XX2 3
_connectionStringXX3 D
)XXD E
)XXE F
{YY 
stringZZ 
sqlQueryZZ 
=ZZ  !
$strZZ" a
;ZZa b
var[[ 
cmd[[ 
=[[ 
new[[ 
OracleCommand[[ +
([[+ ,
sqlQuery[[, 4
,[[4 5
conn[[6 :
)[[: ;
;[[; <
cmd\\ 
.\\ 

Parameters\\ 
.\\ 
Add\\ "
(\\" #
$str\\# 2
,\\2 3
OracleDbType\\4 @
.\\@ A
Varchar2\\A I
)\\I J
.\\J K
Value\\K P
=\\Q R
categoryCode\\S _
;\\_ `
conn^^ 
.^^ 
Open^^ 
(^^ 
)^^ 
;^^ 
int__ 
count__ 
=__ 
Convert__ #
.__# $
ToInt32__$ +
(__+ ,
cmd__, /
.__/ 0
ExecuteScalar__0 =
(__= >
)__> ?
)__? @
;__@ A
conn`` 
.`` 
Close`` 
(`` 
)`` 
;`` 
returnbb 
countbb 
>bb 
$numbb  
;bb  !
}cc 
}dd 	
}ee 
}ff ´
BC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\DBConnect.cs
	namespace 	
ToolSYS
 
. 
Data 
{ 
public 

static 
class 
	DbConnect !
{ 
public 
static 
string 
Oradb "
=># % 
ConfigurationManager& :
.: ;
ConnectionStrings; L
[L M
$strM T
]T U
.U V
ConnectionStringV f
;f g
} 
}		 ¹Œ
EC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\CustomerData.cs
	namespace 	
ToolSYS
 
. 
Data 
{ 
public 

	interface 
ICustomerData "
{ 
int		 
GetNextCustomerId		 
(		 
)		 
;		  
void

 
AddCustomer

 
(

 
Customer

 !
customer

" *
)

* +
;

+ ,
void 
UpdateCustomer 
( 
Customer $
customer% -
)- .
;. /
DataSet 
SearchCustomers 
(  
string  &
searchPhrase' 3
)3 4
;4 5
DataSet  
GetFilteredCustomers $
($ %
string% +
custIdAsString, :
,: ;
string< B
forenameC K
,K L
stringM S
surnameT [
,[ \
string] c
emaild i
,i j
stringk q
phoner w
,w x
stringy 
eircode
€ ‡
,
‡ ˆ
string
‰ 
phrase
 –
)
– —
;
— ˜
} 
public 

class 
CustomerData 
: 
ICustomerData  -
{ 
private 
readonly 
string 
_connectionString  1
=2 3
	DbConnect4 =
.= >
Oradb> C
;C D
public 
int 
GetNextCustomerId $
($ %
)% &
{ 	
using 
( 
var 
conn 
= 
new !
OracleConnection" 2
(2 3
_connectionString3 D
)D E
)E F
{ 
var 
cmd 
= 
new 
OracleCommand +
(+ ,
$str, ?
,? @
connA E
)E F
{ 
CommandType 
=  !
CommandType" -
.- .
StoredProcedure. =
} 
; 
cmd 
. 

Parameters 
. 
Add "
(" #
$str# 5
,5 6
OracleDbType7 C
.C D
Int32D I
,I J
ParameterDirectionK ]
.] ^
Output^ d
)d e
;e f
conn 
. 
Open 
( 
) 
; 
cmd   
.   
ExecuteNonQuery   #
(  # $
)  $ %
;  % &
int!! 
nextCustomerId!! "
=!!# $
Convert!!% ,
.!!, -
ToInt32!!- 4
(!!4 5
cmd!!5 8
.!!8 9

Parameters!!9 C
[!!C D
$str!!D V
]!!V W
.!!W X
Value!!X ]
.!!] ^
ToString!!^ f
(!!f g
)!!g h
)!!h i
;!!i j
conn"" 
."" 
Close"" 
("" 
)"" 
;"" 
return$$ 
nextCustomerId$$ %
;$$% &
}%% 
}&& 	
public(( 
void(( 
AddCustomer(( 
(((  
Customer((  (
customer(() 1
)((1 2
{)) 	
using** 
(** 
var** 
conn** 
=** 
new** !
OracleConnection**" 2
(**2 3
_connectionString**3 D
)**D E
)**E F
{++ 
var,, 
cmd,, 
=,, 
new,, 
OracleCommand,, +
(,,+ ,
$str,,, 9
,,,9 :
conn,,; ?
),,? @
{-- 
CommandType.. 
=..  !
CommandType.." -
...- .
StoredProcedure... =
}// 
;// 
cmd11 
.11 

Parameters11 
.11 
Add11 "
(11" #
$str11# 1
,111 2
OracleDbType113 ?
.11? @
Int3211@ E
)11E F
.11F G
Value11G L
=11M N
customer11O W
.11W X

customerId11X b
;11b c
cmd22 
.22 

Parameters22 
.22 
Add22 "
(22" #
$str22# /
,22/ 0
OracleDbType221 =
.22= >
Varchar222> F
)22F G
.22G H
Value22H M
=22N O
customer22P X
.22X Y
forename22Y a
;22a b
cmd33 
.33 

Parameters33 
.33 
Add33 "
(33" #
$str33# .
,33. /
OracleDbType330 <
.33< =
Varchar233= E
)33E F
.33F G
Value33G L
=33M N
customer33O W
.33W X
surname33X _
;33_ `
cmd44 
.44 

Parameters44 
.44 
Add44 "
(44" #
$str44# ,
,44, -
OracleDbType44. :
.44: ;
Varchar244; C
)44C D
.44D E
Value44E J
=44K L
customer44M U
.44U V
email44V [
;44[ \
cmd55 
.55 

Parameters55 
.55 
Add55 "
(55" #
$str55# ,
,55, -
OracleDbType55. :
.55: ;
Varchar255; C
)55C D
.55D E
Value55E J
=55K L
customer55M U
.55U V
phone55V [
;55[ \
cmd66 
.66 

Parameters66 
.66 
Add66 "
(66" #
$str66# .
,66. /
OracleDbType660 <
.66< =
Varchar266= E
)66E F
.66F G
Value66G L
=66M N
customer66O W
.66W X
eircode66X _
;66_ `
conn88 
.88 
Open88 
(88 
)88 
;88 
cmd99 
.99 
ExecuteNonQuery99 #
(99# $
)99$ %
;99% &
conn:: 
.:: 
Close:: 
(:: 
):: 
;:: 
};; 
}<< 	
public>> 
void>> 
UpdateCustomer>> "
(>>" #
Customer>># +
customer>>, 4
)>>4 5
{?? 	
using@@ 
(@@ 
var@@ 
conn@@ 
=@@ 
new@@ !
OracleConnection@@" 2
(@@2 3
_connectionString@@3 D
)@@D E
)@@E F
{AA 
varBB 
cmdBB 
=BB 
newBB 
OracleCommandBB +
(BB+ ,
$strBB, <
,BB< =
connBB> B
)BBB C
{CC 
CommandTypeDD 
=DD  !
CommandTypeDD" -
.DD- .
StoredProcedureDD. =
}EE 
;EE 
cmdGG 
.GG 

ParametersGG 
.GG 
AddGG "
(GG" #
$strGG# 1
,GG1 2
OracleDbTypeGG3 ?
.GG? @
Int32GG@ E
)GGE F
.GGF G
ValueGGG L
=GGM N
customerGGO W
.GGW X

customerIdGGX b
;GGb c
cmdHH 
.HH 

ParametersHH 
.HH 
AddHH "
(HH" #
$strHH# /
,HH/ 0
OracleDbTypeHH1 =
.HH= >
Varchar2HH> F
)HHF G
.HHG H
ValueHHH M
=HHN O
customerHHP X
.HHX Y
forenameHHY a
;HHa b
cmdII 
.II 

ParametersII 
.II 
AddII "
(II" #
$strII# .
,II. /
OracleDbTypeII0 <
.II< =
Varchar2II= E
)IIE F
.IIF G
ValueIIG L
=IIM N
customerIIO W
.IIW X
surnameIIX _
;II_ `
cmdJJ 
.JJ 

ParametersJJ 
.JJ 
AddJJ "
(JJ" #
$strJJ# ,
,JJ, -
OracleDbTypeJJ. :
.JJ: ;
Varchar2JJ; C
)JJC D
.JJD E
ValueJJE J
=JJK L
customerJJM U
.JJU V
emailJJV [
;JJ[ \
cmdKK 
.KK 

ParametersKK 
.KK 
AddKK "
(KK" #
$strKK# ,
,KK, -
OracleDbTypeKK. :
.KK: ;
Varchar2KK; C
)KKC D
.KKD E
ValueKKE J
=KKK L
customerKKM U
.KKU V
phoneKKV [
;KK[ \
cmdLL 
.LL 

ParametersLL 
.LL 
AddLL "
(LL" #
$strLL# .
,LL. /
OracleDbTypeLL0 <
.LL< =
Varchar2LL= E
)LLE F
.LLF G
ValueLLG L
=LLM N
customerLLO W
.LLW X
eircodeLLX _
;LL_ `
connNN 
.NN 
OpenNN 
(NN 
)NN 
;NN 
cmdOO 
.OO 
ExecuteNonQueryOO #
(OO# $
)OO$ %
;OO% &
connPP 
.PP 
ClosePP 
(PP 
)PP 
;PP 
}QQ 
}RR 	
publicTT 
DataSetTT 
SearchCustomersTT &
(TT& '
stringTT' -
searchPhraseTT. :
)TT: ;
{UU 	
usingVV 
(VV 
varVV 
connVV 
=VV 
newVV !
OracleConnectionVV" 2
(VV2 3
_connectionStringVV3 D
)VVD E
)VVE F
{WW 
varXX 
cmdXX 
=XX 
newXX 
OracleCommandXX +
(XX+ ,
$strXX, =
,XX= >
connXX? C
)XXC D
{YY 
CommandTypeZZ 
=ZZ  !
CommandTypeZZ" -
.ZZ- .
StoredProcedureZZ. =
}[[ 
;[[ 
cmd]] 
.]] 

Parameters]] 
.]] 
Add]] "
(]]" #
$str]]# 3
,]]3 4
OracleDbType]]5 A
.]]A B
Varchar2]]B J
)]]J K
.]]K L
Value]]L Q
=]]R S
searchPhrase]]T `
;]]` a
cmd^^ 
.^^ 

Parameters^^ 
.^^ 
Add^^ "
(^^" #
$str^^# -
,^^- .
OracleDbType^^/ ;
.^^; <
	RefCursor^^< E
)^^E F
.^^F G
	Direction^^G P
=^^Q R
ParameterDirection^^S e
.^^e f
Output^^f l
;^^l m
conn`` 
.`` 
Open`` 
(`` 
)`` 
;`` 
OracleDataAdapteraa !
daaa" $
=aa% &
newaa' *
OracleDataAdapteraa+ <
(aa< =
cmdaa= @
)aa@ A
;aaA B
DataSetbb 
dsbb 
=bb 
newbb  
DataSetbb! (
(bb( )
)bb) *
;bb* +
dacc 
.cc 
Fillcc 
(cc 
dscc 
,cc 
$strcc &
)cc& '
;cc' (
conndd 
.dd 
Closedd 
(dd 
)dd 
;dd 
returnff 
dsff 
;ff 
}gg 
}hh 	
publicjj 
DataSetjj  
GetFilteredCustomersjj +
(jj+ ,
stringjj, 2
custIdAsStringjj3 A
,jjA B
stringjjC I
forenamejjJ R
,jjR S
stringjjT Z
surnamejj[ b
,jjb c
stringjjd j
emailjjk p
,jjp q
stringjjr x
phonejjy ~
,jj~ 
string
jj€ †
eircode
jj‡ Ž
,
jjŽ 
string
jj –
phrase
jj— 
)
jj ž
{kk 	
usingll 
(ll 
varll 
connll 
=ll 
newll !
OracleConnectionll" 2
(ll2 3
_connectionStringll3 D
)llD E
)llE F
{mm 
varnn 
cmdnn 
=nn 
newnn 
OracleCommandnn +
(nn+ ,
$strnn, B
,nnB C
connnnD H
)nnH I
{oo 
CommandTypepp 
=pp  !
CommandTypepp" -
.pp- .
StoredProcedurepp. =
}qq 
;qq 
intss 
?ss 

customerIdss 
=ss  !
nullss" &
;ss& '
iftt 
(tt 
inttt 
.tt 
TryParsett  
(tt  !
custIdAsStringtt! /
,tt/ 0
outtt1 4
inttt5 8
parsedIdtt9 A
)ttA B
)ttB C

customerIduu 
=uu  
parsedIduu! )
;uu) *
cmdww 
.ww 

Parametersww 
.ww 
Addww "
(ww" #
$strww# 1
,ww1 2
OracleDbTypeww3 ?
.ww? @
Int32ww@ E
)wwE F
.wwF G
ValuewwG L
=wwM N

customerIdwwO Y
.wwY Z
HasValuewwZ b
?wwc d
(wwe f
objectwwf l
)wwl m

customerIdwwm w
.www x
Valuewwx }
:ww~ 
DBNull
ww€ †
.
ww† ‡
Value
ww‡ Œ
;
wwŒ 
cmdxx 
.xx 

Parametersxx 
.xx 
Addxx "
(xx" #
$strxx# /
,xx/ 0
OracleDbTypexx1 =
.xx= >
Varchar2xx> F
)xxF G
.xxG H
ValuexxH M
=xxN O
stringxxP V
.xxV W
IsNullOrEmptyxxW d
(xxd e
forenamexxe m
)xxm n
?xxo p
DBNullxxq w
.xxw x
Valuexxx }
:xx~ 
(
xx€ 
object
xx ‡
)
xx‡ ˆ
forename
xxˆ 
;
xx ‘
cmdyy 
.yy 

Parametersyy 
.yy 
Addyy "
(yy" #
$stryy# .
,yy. /
OracleDbTypeyy0 <
.yy< =
Varchar2yy= E
)yyE F
.yyF G
ValueyyG L
=yyM N
stringyyO U
.yyU V
IsNullOrEmptyyyV c
(yyc d
surnameyyd k
)yyk l
?yym n
DBNullyyo u
.yyu v
Valueyyv {
:yy| }
(yy~ 
object	yy …
)
yy… †
surname
yy† 
;
yy Ž
cmdzz 
.zz 

Parameterszz 
.zz 
Addzz "
(zz" #
$strzz# ,
,zz, -
OracleDbTypezz. :
.zz: ;
Varchar2zz; C
)zzC D
.zzD E
ValuezzE J
=zzK L
stringzzM S
.zzS T
IsNullOrEmptyzzT a
(zza b
emailzzb g
)zzg h
?zzi j
DBNullzzk q
.zzq r
Valuezzr w
:zzx y
(zzz {
object	zz{ 
)
zz ‚
email
zz‚ ‡
;
zz‡ ˆ
cmd{{ 
.{{ 

Parameters{{ 
.{{ 
Add{{ "
({{" #
$str{{# ,
,{{, -
OracleDbType{{. :
.{{: ;
Varchar2{{; C
){{C D
.{{D E
Value{{E J
={{K L
string{{M S
.{{S T
IsNullOrEmpty{{T a
({{a b
phone{{b g
){{g h
?{{i j
DBNull{{k q
.{{q r
Value{{r w
:{{x y
({{z {
object	{{{ 
)
{{ ‚
phone
{{‚ ‡
;
{{‡ ˆ
cmd|| 
.|| 

Parameters|| 
.|| 
Add|| "
(||" #
$str||# .
,||. /
OracleDbType||0 <
.||< =
Varchar2||= E
)||E F
.||F G
Value||G L
=||M N
string||O U
.||U V
IsNullOrEmpty||V c
(||c d
eircode||d k
)||k l
?||m n
DBNull||o u
.||u v
Value||v {
:||| }
(||~ 
object	|| …
)
||… †
eircode
||† 
;
|| Ž
cmd}} 
.}} 

Parameters}} 
.}} 
Add}} "
(}}" #
$str}}# -
,}}- .
OracleDbType}}/ ;
.}}; <
Varchar2}}< D
)}}D E
.}}E F
Value}}F K
=}}L M
string}}N T
.}}T U
IsNullOrEmpty}}U b
(}}b c
phrase}}c i
)}}i j
?}}k l
DBNull}}m s
.}}s t
Value}}t y
:}}z {
(}}| }
object	}}} ƒ
)
}}ƒ „
phrase
}}„ Š
;
}}Š ‹
cmd~~ 
.~~ 

Parameters~~ 
.~~ 
Add~~ "
(~~" #
$str~~# -
,~~- .
OracleDbType~~/ ;
.~~; <
	RefCursor~~< E
)~~E F
.~~F G
	Direction~~G P
=~~Q R
ParameterDirection~~S e
.~~e f
Output~~f l
;~~l m
conn
€€ 
.
€€ 
Open
€€ 
(
€€ 
)
€€ 
;
€€ 
OracleDataAdapter
 !
da
" $
=
% &
new
' *
OracleDataAdapter
+ <
(
< =
cmd
= @
)
@ A
;
A B
DataSet
‚‚ 
ds
‚‚ 
=
‚‚ 
new
‚‚  
DataSet
‚‚! (
(
‚‚( )
)
‚‚) *
;
‚‚* +
da
ƒƒ 
.
ƒƒ 
Fill
ƒƒ 
(
ƒƒ 
ds
ƒƒ 
,
ƒƒ 
$str
ƒƒ &
)
ƒƒ& '
;
ƒƒ' (
conn
„„ 
.
„„ 
Close
„„ 
(
„„ 
)
„„ 
;
„„ 
return
†† 
ds
†† 
;
†† 
}
‡‡ 
}
ˆˆ 	
}
‰‰ 
}ŠŠ ‰7
EC:\GitHub\SoftwareDesignPatterns\ToolSYS\ToolSYS.Data\AnalysisData.cs
	namespace 	
ToolSYS
 
. 
Data 
{ 
public 

	interface 
IAnalysisData "
{ 
	DataTable 
GetDistinctYears "
(" #
)# $
;$ %
	DataTable		 
GetMonthlyRevenues		 $
(		$ %
int		% (
year		) -
)		- .
;		. /
	DataTable

 
GetMonthlyRentals

 #
(

# $
int

$ '
year

( ,
)

, -
;

- .
	DataTable 
GetCategoryRentals $
($ %
int% (
year) -
)- .
;. /
} 
public 

class 
AnalysisData 
: 
IAnalysisData  -
{ 
private 
readonly 
string 
_connectionString  1
=2 3
	DbConnect4 =
.= >
Oradb> C
;C D
public 
	DataTable 
GetDistinctYears )
() *
)* +
{ 	
using 
( 
var 
conn 
= 
new !
OracleConnection" 2
(2 3
_connectionString3 D
)D E
)E F
{ 
string 
sqlQuery 
=  !
$str" w
;w x
OracleCommand 
cmd !
=" #
new$ '
OracleCommand( 5
(5 6
sqlQuery6 >
,> ?
conn@ D
)D E
;E F
conn 
. 
Open 
( 
) 
; 
	DataTable 

yearsTable $
=% &
new' *
	DataTable+ 4
(4 5
)5 6
;6 7
using 
( 
OracleDataReader '
reader( .
=/ 0
cmd1 4
.4 5
ExecuteReader5 B
(B C
)C D
)D E
{ 

yearsTable 
. 
Load #
(# $
reader$ *
)* +
;+ ,
} 
return   

yearsTable   !
;  ! "
}!! 
}"" 	
public$$ 
	DataTable$$ 
GetMonthlyRevenues$$ +
($$+ ,
int$$, /
year$$0 4
)$$4 5
{%% 	
string&& 
sqlQuery&& 
=&& 
$str&+ <
;++< =
using-- 
(-- 
var-- 
conn-- 
=-- 
new-- !
OracleConnection--" 2
(--2 3
_connectionString--3 D
)--D E
)--E F
{.. 
OracleCommand// 
cmd// !
=//" #
new//$ '
OracleCommand//( 5
(//5 6
sqlQuery//6 >
,//> ?
conn//@ D
)//D E
;//E F
cmd00 
.00 

Parameters00 
.00 
Add00 "
(00" #
$str00# *
,00* +
year00, 0
.000 1
ToString001 9
(009 :
)00: ;
)00; <
;00< =
	DataTable22 
revenueTable22 &
=22' (
new22) ,
	DataTable22- 6
(226 7
)227 8
;228 9
OracleDataAdapter33 !
da33" $
=33% &
new33' *
OracleDataAdapter33+ <
(33< =
cmd33= @
)33@ A
;33A B
conn55 
.55 
Open55 
(55 
)55 
;55 
da66 
.66 
Fill66 
(66 
revenueTable66 $
)66$ %
;66% &
return88 
revenueTable88 #
;88# $
}99 
}:: 	
public<< 
	DataTable<< 
GetMonthlyRentals<< *
(<<* +
int<<+ .
year<</ 3
)<<3 4
{== 	
string>> 
sqlQuery>> 
=>> 
$str>E 
;EE  
usingGG 
(GG 
varGG 
connGG 
=GG 
newGG !
OracleConnectionGG" 2
(GG2 3
_connectionStringGG3 D
)GGD E
)GGE F
{HH 
OracleCommandII 
cmdII !
=II" #
newII$ '
OracleCommandII( 5
(II5 6
sqlQueryII6 >
,II> ?
connII@ D
)IID E
;IIE F
cmdJJ 
.JJ 

ParametersJJ 
.JJ 
AddJJ "
(JJ" #
$strJJ# *
,JJ* +
yearJJ, 0
.JJ0 1
ToStringJJ1 9
(JJ9 :
)JJ: ;
)JJ; <
;JJ< =
OracleDataAdapterLL !
daLL" $
=LL% &
newLL' *
OracleDataAdapterLL+ <
(LL< =
cmdLL= @
)LL@ A
;LLA B
	DataTableMM 
dtMM 
=MM 
newMM "
	DataTableMM# ,
(MM, -
)MM- .
;MM. /
connOO 
.OO 
OpenOO 
(OO 
)OO 
;OO 
daPP 
.PP 
FillPP 
(PP 
dtPP 
)PP 
;PP 
returnRR 
dtRR 
;RR 
}SS 
}TT 	
publicVV 
	DataTableVV 
GetCategoryRentalsVV +
(VV+ ,
intVV, /
yearVV0 4
)VV4 5
{WW 	
stringXX 
sqlQueryXX 
=XX 
$strX` $
;``$ %
usingbb 
(bb 
varbb 
connbb 
=bb 
newbb !
OracleConnectionbb" 2
(bb2 3
_connectionStringbb3 D
)bbD E
)bbE F
{cc 
OracleCommanddd 
cmddd !
=dd" #
newdd$ '
OracleCommanddd( 5
(dd5 6
sqlQuerydd6 >
,dd> ?
conndd@ D
)ddD E
;ddE F
cmdee 
.ee 

Parametersee 
.ee 
Addee "
(ee" #
$stree# *
,ee* +
yearee, 0
.ee0 1
ToStringee1 9
(ee9 :
)ee: ;
)ee; <
;ee< =
	DataTablegg 
categoryRentalTablegg -
=gg. /
newgg0 3
	DataTablegg4 =
(gg= >
)gg> ?
;gg? @
OracleDataAdapterhh !
dahh" $
=hh% &
newhh' *
OracleDataAdapterhh+ <
(hh< =
cmdhh= @
)hh@ A
;hhA B
connjj 
.jj 
Openjj 
(jj 
)jj 
;jj 
dakk 
.kk 
Fillkk 
(kk 
categoryRentalTablekk +
)kk+ ,
;kk, -
returnmm 
categoryRentalTablemm *
;mm* +
}nn 
}oo 	
}pp 
}qq 